server:
  port: ${PORT:8081}
spring:
  application:
    # the name of the application represents the global identifier of this microservice.
    name: business-process-service
  cloud:
    config:
      uri: ${CONFIG_SERVER_URI:http://localhost:8888}
      # failFast is disabled per default, so that the service can start standalone without config server.
      # failFast should be enabled in production environments.
      # it can be set via an environment variable or the config server
      failFast: ${CONFIG_SERVER_FAILFAST:false}
    discovery:
      # by disabling the service discovery the application/service can be started in "standalone mode".
      # service discovery is disabled by default and should be enabled (set to true) for the "cloud mode".
      # it can be set via an environment variable or the config server
      enabled: ${discovery.enabled:${DISCOVERY_ENABLED:false}}
  datasource:
    camunda:
      url: jdbc:postgresql://${CAMUNDA_DB_HOST:localhost}:${CAMUNDA_DB_PORT:5432}/${CAMUNDA_DB_NAME:camunda}?currentSchema=public
      username: ${CAMUNDA_DB_USERNAME:postgres}
      password: ${CAMUNDA_DB_PASSWORD:nimble}
      driver-class-name: org.postgresql.Driver
    bpdb:
      url: jdbc:postgresql://${BUSINESS_PROCESS_DB_HOST:localhost}:${BUSINESS_PROCESS_DB_PORT:5432}/${BUSINESS_PROCESS_DB_NAME:businessprocessengine}?currentSchema=public
      username: ${BUSINESS_PROCESS_DB_USERNAME:postgres}
      password: ${BUSINESS_PROCESS_DB_PASSWORD:nimble}
      driver_class: org.postgresql.Driver
    ubldb:
      url: jdbc:postgresql://${UBL_DB_HOST:localhost}:${UBL_DB_HOST_PORT:5432}/${UBL_DB_NAME:ubldb}?currentSchema=public
      username: ${UBL_DB_USERNAME:postgres}
      password: ${UBL_DB_PASSWORD:nimble}
      driver_class: org.postgresql.Driver
    tomcat:
      initial-size: 3
      test-while-idle: true
      time-between-eviction-runs-millis: 600000
      min-evictable-idle-time-millis: 3600000
    maxActive: 10
    maxIdle: 3
    minIdle: 3
  kafka:
      bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS}
      consumer:
        group-id: business-process-service${KAFKA_CONSUMER_GROUP_ID_SUFFIX:}
      properties:
        sasl:
          jaas:
            config: ${KAFKA_JAAS_CONFIG}
  mail:
    debug: false  # disable printing email to log output
    host: ${SMTP_HOST:localhost}
    port: ${SMTP_PORT:25}
    defaultFrom: ${SMTP_DEFAULT_FROM:}
    username: ${SMTP_USERNAME:}
    password: ${SMTP_PASSWORD:}
    smtp.auth: true
    properties.mail.smtp.starttls.enable: true
  jackson:
    date-format: com.fasterxml.jackson.databind.util.ISO8601DateFormat
    serialization:
      WRITE_DATES_AS_TIMESTAMPS: false

springfox:
  documentation:
    swagger:
      v2:
        path: /api-docs

#### c3p0 database connection pool configurations
com:
  mchange:
    v2:
      c3p0:
        impl:
          DefaultConnectionTester:
            querylessTestRunner: SWITCH
      log:
        MLog: slf4j

persistence:
  orm:
    business_process:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        show_sql: false
        hbm2ddl:
          auto: update
        cache:
          provider_class: org.hibernate.cache.HashtableCacheProvider
        jdbc:
          batch_size: 10
        use_sql_comments: true
        transaction:
          factory_class: org.hibernate.transaction.JDBCTransactionFactory
        current_session_context_class: thread
        enable_lazy_load_no_trans: true
        event:
          merge:
            entity_copy_observer: allow
    ubl:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        show_sql: false
        hbm2ddl:
          auto:
        cache:
          provider_class: org.hibernate.cache.HashtableCacheProvider
        jdbc:
          batch_size: 10
        use_sql_comments: true
        transaction:
          factory_class: org.hibernate.transaction.JDBCTransactionFactory
        current_session_context_class: thread
        enable_lazy_load_no_trans: true
        event:
          merge:
            entity_copy_observer: allow
    modaml:
      hibernate:
        connection:
          url: jdbc:h2:file://${user.home}/nimble/modaml;AUTO_SERVER=TRUE;MVCC=TRUE;AUTO_RECONNECT=TRUE;DB_CLOSE_DELAY=10;INIT=create schema IF NOT EXISTS APPS
          username: sa
          password:
          driver_class: org.h2.Driver
        dialect: org.hibernate.dialect.H2Dialect
        show_sql: false
        hbm2ddl:
          auto: update
        cache:
          provider_class: org.hibernate.cache.HashtableCacheProvider
        jdbc:
          batch_size: 0
        c3p0:
          acquire_increment: 2
          initialPoolSize: 2
          max_size: 10
          min_size: 2
          maxStatementsPerConnection: 2
          acquireRetryAttempts: 10
          acquireRetryDelay: 100
          numHelperThreads: 10
          idle_test_period: 600
        use_sql_comments: true
        transaction:
          factory_class: org.hibernate.transaction.JDBCTransactionFactory
        current_session_context_class: thread
        event:
          merge:
            entity_copy_observer: allow

logstash:
  uri: ${LOGSTASH_URI:localhost:5000}

camunda:
  bpm:
    webapp:
      index-redirect-enabled: false
    database:
      schema-update: true
      type: postgres
    admin-user:
      id: kermit
      password: superSecret

nimble:
  cors_enabled: false
  identity:
    url: ${IDENTITY_SERVICE_URL:http://nimble-staging.salzburgresearch.at/identity}
  data-channel:
    url: ${DATA_CHANNEL_SERVICE_URL:http://nimble-staging.salzburgresearch.at/data-channel}
  frontend:
    url: ${FRONTEND_URL:http://nimble-staging.salzburgresearch.at/frontend/}
  kafka:
      topics:
        businessProcessUpdates: ${KAFKA_TOPIC_BUSINESS_PROCESS_UPDATES:business-process-updates-staging}
hystrix:
  command:
    default:
      execution:
        isolation:
          thread:
            timeoutInMilliseconds: 10000

build:
  version: 5.0.0-Staging

################################################################################################
################################## KUBERNETES CONFIG ###########################################
################################################################################################

---

spring:
  profiles: kubernetes

nimble:
  cors_enabled: false
  db-credentials-json: ${DB_CREDENTIALS_JSON}

persistence:
  orm:
    business_process:
      hibernate:
        connection:
          url: # set in eu.nimble.service.bp.config.BusinessProcessPersistenceConfig class
          username: # set in eu.nimble.service.bp.config.BusinessProcessPersistenceConfig class
          password: # set in eu.nimble.service.bp.config.BusinessProcessPersistenceConfig class
          driver_class: org.postgresql.Driver
        dialect: org.hibernate.dialect.PostgreSQLDialect
        show_sql: false
        hbm2ddl:
          auto: update
        cache:
          provider_class: org.hibernate.cache.HashtableCacheProvider
        jdbc:
          batch_size: 0
        c3p0:
          acquire_increment: 3
          initialPoolSize: 3
          max_size: 6
          min_size: 3
          maxStatementsPerConnection: 5
          acquireRetryAttempts: 10
          acquireRetryDelay: 100
          numHelperThreads: 10
          idle_test_period: 600
        use_sql_comments: true
        transaction:
          factory_class: org.hibernate.transaction.JDBCTransactionFactory
        current_session_context_class: thread
        enable_lazy_load_no_trans: true
        event:
          merge:
            entity_copy_observer: allow
      bluemix:
        credentials_json: ${BLUEMIX_BUSINESS_PROCESS_DB_JSON:}
    ubl:
      hibernate:
        connection:
          driver_class: org.postgresql.Driver
        dialect: org.hibernate.dialect.PostgreSQLDialect
        show_sql: false
        hbm2ddl:
          auto: update
        cache:
          provider_class: org.hibernate.cache.HashtableCacheProvider
        jdbc:
          batch_size: 0
        c3p0:
          acquire_increment: 3
          initialPoolSize: 3
          max_size: 6
          min_size: 3
          maxStatementsPerConnection: 5
          acquireRetryAttempts: 10
          acquireRetryDelay: 100
          numHelperThreads: 10
          idle_test_period: 600
        use_sql_comments: true
        transaction:
          factory_class: org.hibernate.transaction.JDBCTransactionFactory
        current_session_context_class: thread
        enable_lazy_load_no_trans: true
        event:
          merge:
            entity_copy_observer: allow
      bluemix:
        credentials_json: ${BLUEMIX_UBL_DB_JSON:}
    modaml:
      hibernate:
        connection:
          driver_class: org.postgresql.Driver
        dialect: org.hibernate.dialect.PostgreSQLDialect
        show_sql: false
        hbm2ddl:
          auto: update
        cache:
          provider_class: org.hibernate.cache.HashtableCacheProvider
        jdbc:
          batch_size: 0
        c3p0:
          acquire_increment: 2
          initialPoolSize: 2
          max_size: 10
          min_size: 2
          maxStatementsPerConnection: 2
          acquireRetryAttempts: 10
          acquireRetryDelay: 100
          numHelperThreads: 10
          idle_test_period: 600
        use_sql_comments: true
        transaction:
          factory_class: org.hibernate.transaction.JDBCTransactionFactory
        current_session_context_class: thread
        event:
          merge:
            entity_copy_observer: allow
      bluemix:
        credentials_json: ${BLUEMIX_MODAML_DB_JSON:}


################################################################################################
################################### LOCAL DEV CONFIG ###########################################
################################################################################################

---

spring:
  profiles: local_dev
  # Local h2 database
  datasource:
    url: jdbc:h2:mem:db;MVCC=TRUE;AUTO_RECONNECT=TRUE;DB_CLOSE_ON_EXIT=FALSE;INIT=create schema IF NOT EXISTS APPS
    username: sa
    password:
    driverClassName: org.h2.Driver
    camunda:
      url: jdbc:h2:mem:db;MVCC=TRUE;AUTO_RECONNECT=TRUE;DB_CLOSE_ON_EXIT=FALSE;INIT=create schema IF NOT EXISTS APPS
      username: sa
      password:
      driverClassName: org.h2.Driver
    bpdb:
      url: jdbc:h2:mem:db2;MVCC=TRUE;AUTO_RECONNECT=TRUE;DB_CLOSE_ON_EXIT=FALSE;INIT=create schema IF NOT EXISTS APPS
      username: sa
      password:
      driverClassName: org.h2.Driver
    ubldb:
      url: jdbc:h2:mem:db3;MVCC=TRUE;AUTO_RECONNECT=TRUE;DB_CLOSE_ON_EXIT=FALSE;INIT=create schema IF NOT EXISTS APPS
      username: sa
      password:
      driverClassName: org.h2.Driver
  h2:
    console:
      enabled: true
persistence:
  orm:
    ubl:
      hibernate:
        dialect: org.hibernate.dialect.H2Dialect
        hbm2ddl:
          auto: update
    business_process:
      hibernate:
        dialect: org.hibernate.dialect.H2Dialect
        hbm2ddl:
          auto: update
camunda:
  bpm:
    webapp:
      index-redirect-enabled: false
    database:
      schema-update: true
      type: postgres
    admin-user:
      id: kermit
      password: superSecret

nimble:
  cors_enabled: true
  identity:
    url: ${IDENTITY_SERVICE_URL:http://nimble-staging.salzburgresearch.at/identity}
  data-channel:
    url: ${DATA_CHANNEL_SERVICE_URL:http://nimble-staging.salzburgresearch.at/data-channel}
  frontend:
    url: ${FRONTEND_URL:http://nimble-staging.salzburgresearch.at/frontend/}
  kafka:
      topics:
        businessProcessUpdates: ${KAFKA_TOPIC_BUSINESS_PROCESS_UPDATES:business-process-updates-staging}
build:
  version: 5.0.0-Staging